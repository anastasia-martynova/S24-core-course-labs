# Task 1
## Kubernetes Secrets

### Creation

``` bash
(venv) anastasiamartynova@Anastasias-MacBook-Pro k8s % kubectl create secret generic lab-secret --from-literal=username='anastasiamartynova' --from-literal=password='12345678'
secret/lab-secret created
```

### Verification
```bash
(venv) anastasiamartynova@Anastasias-MacBook-Pro k8s % kubectl get secrets
NAME         TYPE     DATA   AGE
lab-secret   Opaque   2      10s
```

```bash
(venv) anastasiamartynova@Anastasias-MacBook-Pro k8s % kubectl describe secret lab-secret
Name:         lab-secret
Namespace:    default
Labels:       <none>
Annotations:  <none>

Type:  Opaque

Data
====
password:  8 bytes
username:  18 bytes
```
### Decoding

```bash
(venv) anastasiamartynova@Anastasias-MacBook-Pro k8s % echo $(kubectl get secret lab-secret -o jsonpath='{.data}')
{"password":"MTIzNDU2Nzg=","username":"YW5hc3Rhc2lhbWFydHlub3Zh"}
```

```bash
(venv) anastasiamartynova@Anastasias-MacBook-Pro k8s % echo $(echo 'YW5hc3Rhc2lhbWFydHlub3ZhMTIzNDU2Nzg=' | base64 --decode)
anastasiamartynova12345678
```

## Managing Secrets with Helm

```bash
(venv) anastasiamartynova@Anastasias-MacBook-Pro k8s % kubectl get po
NAME                          READY   STATUS    RESTARTS   AGE
app-python-798949fb7b-q79ph   1/1     Running   0          45s
```

```bash
(venv) anastasiamartynova@Anastasias-MacBook-Pro k8s % kubectl exec app-python-798949fb7b-q79ph -- printenv | grep MY_PASSWORD                
MY_PASSWORD=secret1234
```


# Task 2

## Vault Secret Management System

```bash
(venv) anastasiamartynova@Anastasias-MacBook-Pro k8s % kubectl get pods
NAME                                   READY   STATUS    RESTARTS   AGE
app-python-798949fb7b-q79ph            1/1     Running   0          60m
vault-0                                1/1     Running   0          44m
vault-agent-injector-dbfc5cd77-qmm2l   1/1     Running   0          44m
```

## Implementing Vault Secrets

```bash
(venv) anastasiamartynova@Anastasias-MacBook-Pro k8s % kubectl exec -it vault-0 -- /bin/sh
/ $ vault secrets enable -path=internal kv-v2
Success! Enabled the kv-v2 secrets engine at: internal/
/ $ vault kv put internal/server/config password="123"
======= Secret Path =======
internal/data/server/config

======= Metadata =======
Key                Value
---                -----
created_time       2024-04-16T12:47:32.806914799Z
custom_metadata    <nil>
deletion_time      n/a
destroyed          false
version            1
/ $ vault kv get internal/server/config
======= Secret Path =======
internal/data/server/config

======= Metadata =======
Key                Value
---                -----
created_time       2024-04-16T12:47:32.806914799Z
custom_metadata    <nil>
deletion_time      n/a
destroyed          false
version            1

====== Data ======
Key         Value
---         -----
password    123
/ $ vault auth enable kubernetes
Success! Enabled kubernetes auth method at: kubernetes/
/ $ vault write auth/kubernetes/config kubernetes_host="https://$KUBERNETES_PORT_443_TCP_ADDR:443"
Success! Data written to: auth/kubernetes/config
/ $ vault policy write internal-app - <<EOF
> path "internal/data/server/config" { capabilities = ["read"] }
> EOF
Success! Uploaded policy: internal-app
/ $ vault write auth/kubernetes/role/internal-app \
> bound_service_account_names=internal-app \
> bound_service_account_namespaces=default \
> policies=internal-app \
> ttl=24h
Success! Data written to: auth/kubernetes/role/internal-app
/ $ exit
```

```bash
(venv) anastasiamartynova@Anastasias-MacBook-Pro k8s % kubectl exec -it app-python-798949fb7b-q79ph -- /bin/sh
/app_python $ df -h
Filesystem                Size      Used Available Use% Mounted on
overlay                  58.4G      9.2G     46.2G  17% /
tmpfs                    64.0M         0     64.0M   0% /dev
/dev/vda1                58.4G      9.2G     46.2G  17% /dev/termination-log
/dev/vda1                58.4G      9.2G     46.2G  17% /etc/resolv.conf
/dev/vda1                58.4G      9.2G     46.2G  17% /etc/hostname
/dev/vda1                58.4G      9.2G     46.2G  17% /etc/hosts
shm                      64.0M         0     64.0M   0% /dev/shm
tmpfs                     7.7G     12.0K      7.7G   0% /run/secrets/kubernetes.io/serviceaccount
tmpfs                    64.0M         0     64.0M   0% /proc/kcore
tmpfs                    64.0M         0     64.0M   0% /proc/keys
tmpfs                    64.0M         0     64.0M   0% /proc/timer_list
tmpfs                     3.8G         0      3.8G   0% /sys/firmware
```